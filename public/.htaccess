<IfModule mod_rewrite.c>
  Options -MultiViews
  RewriteEngine On
  RewriteBase /

  # 1. If request is a directory, let it pass (for assets/images)
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]

  # 2. If request has .html extension, redirect to remove it (canonical URL)
  RewriteCond %{THE_REQUEST} \s/+(.+?)\.html[\s?] [NC]
  RewriteRule ^ /%1 [R=301,L,NE]

  # 3. If request doesn't have extension and file.html exists, rewrite internally
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_FILENAME}.html -f
  RewriteRule ^(.*)$ $1.html [L]
  
  # Custom 404
  ErrorDocument 404 /404.html
</IfModule>
